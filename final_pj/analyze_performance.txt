# Performance Analysis - CIFAR-10 Autoencoder CPU

## Your Result: 2.5 imgs/s

### Tính toán complexity:

**Forward pass cho 1 image:**

1. Conv2D(3→256, 3×3, 32×32):
   - Operations: 32 × 32 × 256 × (3 × 3 × 3) = 75,497,472 ops
   - ~75M multiply-adds

2. ReLU: 32 × 32 × 256 = 262,144 ops (negligible)

3. MaxPool(2×2): 16 × 16 × 256 = 65,536 ops (negligible)

4. Conv2D(256→128, 3×3, 16×16):
   - Operations: 16 × 16 × 128 × (3 × 3 × 256) = 75,497,472 ops
   - ~75M multiply-adds

5. MaxPool(2×2): 8 × 8 × 128 = 8,192 ops

**Encoder total: ~150M multiply-adds**

**Decoder similar: ~150M multiply-adds**

**Total forward: ~300M operations per image**

### Backward pass:
- Roughly 2-3x forward pass
- Total: ~900M operations per image

### Per epoch (with batch_size=32):
- Total operations: 900M × num_samples
- For 1000 samples: 900 billion operations

## Analysis:

**Your speed: 2.5 imgs/s**
- Time per image: 0.4 seconds
- Operations per second: 300M / 0.4 = 750M ops/s
- Plus backward: ~2.25 billion ops/s

**Expected on modern CPU (M1/M2):**
- Peak FLOPS: ~50-100 GFLOPS (single precision)
- Realistic with naive code: ~5-10 GFLOPS
- Expected: 5-10 billion ops/s

**Your performance: ~2.25 GFLOPS (0.002 TFLOPS)**

## Verdict: CODE CÓ ISSUE!

Should be ~5-10x faster minimum (10-25 imgs/s with naive implementation)

## Possible Issues:

1. ❌ Compiler optimization not working
2. ❌ Debug mode enabled (-O0 instead of -O3)
3. ❌ Memory allocation in hot loop
4. ❌ Cache thrashing
5. ❌ Algorithm bug causing unnecessary work

## Check:
- Verify -O3 flag is actually used
- Check for memory leaks
- Profile with instruments/perf
